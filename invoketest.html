<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
    <style>
        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
        }

        .container {
            width: 100%;
            padding: 15px;
        }

        @media screen and (min-width: 700px) {
            .container {
                width: 70%;
                margin: auto;
            }
        }

        p {
            white-space: pre-wrap; 
            word-wrap: break-word; 
            overflow-wrap: break-word; 
        }

        .bold-and-larger {
            font-weight: bold; 
            font-size: 1.5em; 
        }

        .larger {
            font-weight: bold; 
            font-size: 1.2em; 
        }

        .execution-log {
            margin-top: 15px;
            padding: 10px;
            border-top: 1px solid #eee;
        }

        .execution-item {
            color: #333;
            margin: 5px 0;
            padding: 5px;
            background-color: #f9f9f9;
            border-radius: 3px;
        }

    </style>
    <title>InvokeTest Page</title>

</head>

<body>
    <h1>InvokeTest Page</h1>

    <p>!!! This is just a demo page, NO Sensitive Data will be stored!!!</p>

    <p> Click the button to trigger all captured potential sensitive interface invocations. </p>

    <!-- Display total number of invocations -->
    <p><span class="larger">Total invocations to execute: <span id="totalInvocations">0</span></span></p>

    <p><span class="larger">Trigger</span></p>
    <input type="button" value="Trigger" id="Trigger" style="font-size: 20px; padding: 20px 25px;"/>

    <!-- Execution log container -->
    <div class="execution-log" id="executionLog"></div>

    <br><br><br>

    <script>
        function setupWebViewJavascriptBridge(callback) {
            if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
            if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
            window.WVJBCallbacks = [callback];
            var WVJBIframe = document.createElement('iframe');
            WVJBIframe.style.display = 'none';
            WVJBIframe.src = 'https://__bridge_loaded__';
            document.documentElement.appendChild(WVJBIframe);
            setTimeout(function () { document.documentElement.removeChild(WVJBIframe) }, 0)
        }

        function sendIframeMsg(url) {
            var iframe = document.createElement("iframe");
            iframe.style.cssText = "display:none;width:0px;height:0px;";
            iframe.src = url;
            document.body.appendChild(iframe);
        }

        //<script src="https://cdn.jsdelivr.net/npm/dsbridge@3.1.4/dist/dsbridge.js"> 
        var bridge = {
        default:
            this,
            call: function(b, a, c) {
                var e = "";
                "function" == typeof a && (c = a, a = {});
                a = {
                    data: void 0 === a ? null: a
                };
                if ("function" == typeof c) {
                    var g = "dscb" + window.dscb++;
                    window[g] = c;
                    a._dscbstub = g
                }
                a = JSON.stringify(a);
                if (window._dsbridge) e = _dsbridge.call(b, a);
                else if (window._dswk || -1 != navigator.userAgent.indexOf("_dsbridge")) e = prompt("_dsbridge=" + b, a);
                return JSON.parse(e || "{}").data
            },
            register: function(b, a, c) {
                c = c ? window._dsaf: window._dsf;
                window._dsInit || (window._dsInit = !0, setTimeout(function() {
                    bridge.call("_dsb.dsinit")
                },
                0));
                "object" == typeof a ? c._obs[b] = a: c[b] = a
            },
            registerAsyn: function(b, a) {
                this.register(b, a, !0)
            },
            hasNativeMethod: function(b, a) {
                return this.call("_dsb.hasNativeMethod", {
                    name: b,
                    type: a || "all"
                })
            },
            disableJavascriptDialogBlock: function(b) {
                this.call("_dsb.disableJavascriptDialogBlock", {
                    disable: !1 !== b
                })
            }
        }; !
        function() {
            if (!window._dsf) {
                var b = {
                    _dsf: {
                        _obs: {}
                    },
                    _dsaf: {
                        _obs: {}
                    },
                    dscb: 0,
                    dsBridge: bridge,
                    close: function() {
                        bridge.call("_dsb.closePage")
                    },
                    _handleMessageFromNative: function(a) {
                        var e = JSON.parse(a.data),
                        b = {
                            id: a.callbackId,
                            complete: !0
                        },
                        c = this._dsf[a.method],
                        d = this._dsaf[a.method],
                        h = function(a, c) {
                            b.data = a.apply(c, e);
                            bridge.call("_dsb.returnValue", b)
                        },
                        k = function(a, c) {
                            e.push(function(a, c) {
                                b.data = a;
                                b.complete = !1 !== c;
                                bridge.call("_dsb.returnValue", b)
                            });
                            a.apply(c, e)
                        };
                        if (c) h(c, this._dsf);
                        else if (d) k(d, this._dsaf);
                        else if (c = a.method.split("."), !(2 > c.length)) {
                            a = c.pop();
                            var c = c.join("."),
                            d = this._dsf._obs,
                            d = d[c] || {},
                            f = d[a];
                            f && "function" == typeof f ? h(f, d) : (d = this._dsaf._obs, d = d[c] || {},
                            (f = d[a]) && "function" == typeof f && k(f, d))
                        }
                    }
                },
                a;
                for (a in b) window[a] = b[a];
                bridge.register("_hasJavascriptMethod",
                function(a, b) {
                    b = a.split(".");
                    if (2 > b.length) return ! (!_dsf[b] && !_dsaf[b]);
                    a = b.pop();
                    b = b.join(".");
                    return (b = _dsf._obs[b] || _dsaf._obs[b]) && !!b[a]
                })
            }
        } ();
        function mycallback(e){
            console.log("[attacker]: " + JSON.stringify(e));
        }
        function printObject(name, value){
            setTimeout(function () { 
                console.log(name + ": " + JSON.stringify(value)); 
            }, 500);
        }

        // Send Finish signal to notify python script
        async function sendFinishSignal() {            
            try {
                // Send request to PHP backend
                const response = await fetch('signal_writer.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        filename: 'invokefinish.txt',
                        content: 'invokefinish'
                    })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    var suc = true;
                } else {
                    var suc = true;
                }
            } catch (error) {
                var suc = true;
            }
        }
        

        // Define invocation array with type information
        const ocCalls = [
            // Invocation 1: IFRAME type
            {
                type: "IFRAME",
                execute: function() {
                    // ==============================================

                    // Auto-generated InvokCode.js

                    function setupWebViewJavascriptBridge(callback) {
                        if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
                        if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
                        window.WVJBCallbacks = [callback];
                        var WVJBIframe = document.createElement('iframe');
                        WVJBIframe.style.display = 'none';
                        WVJBIframe.src = 'https://__bridge_loaded__';
                        document.documentElement.appendChild(WVJBIframe);
                        setTimeout(function () { document.documentElement.removeChild(WVJBIframe) }, 0)
                    }

                    function sendIframeMsg(url) {
                        var iframe = document.createElement("iframe");
                        iframe.style.cssText = "display:none;width:0px;height:0px;";
                        iframe.src = url;
                        document.body.appendChild(iframe);
                    }

                    //<script src="https://cdn.jsdelivr.net/npm/dsbridge@3.1.4/dist/dsbridge.js"> 
                    var bridge = {
                    default:
                        this,
                        call: function(b, a, c) {
                            var e = "";
                            "function" == typeof a && (c = a, a = {});
                            a = {
                                data: void 0 === a ? null: a
                            };
                            if ("function" == typeof c) {
                                var g = "dscb" + window.dscb++;
                                window[g] = c;
                                a._dscbstub = g
                            }
                            a = JSON.stringify(a);
                            if (window._dsbridge) e = _dsbridge.call(b, a);
                            else if (window._dswk || -1 != navigator.userAgent.indexOf("_dsbridge")) e = prompt("_dsbridge=" + b, a);
                            return JSON.parse(e || "{}").data
                        },
                        register: function(b, a, c) {
                            c = c ? window._dsaf: window._dsf;
                            window._dsInit || (window._dsInit = !0, setTimeout(function() {
                                bridge.call("_dsb.dsinit")
                            },
                            0));
                            "object" == typeof a ? c._obs[b] = a: c[b] = a
                        },
                        registerAsyn: function(b, a) {
                            this.register(b, a, !0)
                        },
                        hasNativeMethod: function(b, a) {
                            return this.call("_dsb.hasNativeMethod", {
                                name: b,
                                type: a || "all"
                            })
                        },
                        disableJavascriptDialogBlock: function(b) {
                            this.call("_dsb.disableJavascriptDialogBlock", {
                                disable: !1 !== b
                            })
                        }
                    }; !
                    function() {
                        if (!window._dsf) {
                            var b = {
                                _dsf: {
                                    _obs: {}
                                },
                                _dsaf: {
                                    _obs: {}
                                },
                                dscb: 0,
                                dsBridge: bridge,
                                close: function() {
                                    bridge.call("_dsb.closePage")
                                },
                                _handleMessageFromNative: function(a) {
                                    var e = JSON.parse(a.data),
                                    b = {
                                        id: a.callbackId,
                                        complete: !0
                                    },
                                    c = this._dsf[a.method],
                                    d = this._dsaf[a.method],
                                    h = function(a, c) {
                                        b.data = a.apply(c, e);
                                        bridge.call("_dsb.returnValue", b)
                                    },
                                    k = function(a, c) {
                                        e.push(function(a, c) {
                                            b.data = a;
                                            b.complete = !1 !== c;
                                            bridge.call("_dsb.returnValue", b)
                                        });
                                        a.apply(c, e)
                                    };
                                    if (c) h(c, this._dsf);
                                    else if (d) k(d, this._dsaf);
                                    else if (c = a.method.split("."), !(2 > c.length)) {
                                        a = c.pop();
                                        var c = c.join("."),
                                        d = this._dsf._obs,
                                        d = d[c] || {},
                                        f = d[a];
                                        f && "function" == typeof f ? h(f, d) : (d = this._dsaf._obs, d = d[c] || {},
                                        (f = d[a]) && "function" == typeof f && k(f, d))
                                    }
                                }
                            },
                            a;
                            for (a in b) window[a] = b[a];
                            bridge.register("_hasJavascriptMethod",
                            function(a, b) {
                                b = a.split(".");
                                if (2 > b.length) return ! (!_dsf[b] && !_dsaf[b]);
                                a = b.pop();
                                b = b.join(".");
                                return (b = _dsf._obs[b] || _dsaf._obs[b]) && !!b[a]
                            })
                        }
                    } ();

                    function mycallback(e){
                        console.log("[attacker]: " + JSON.stringify(e));
                    }

                    function printObject(name, value){
                        setTimeout(function () { 
                            console.log(name + ": " + JSON.stringify(value)); 
                        }, 500);
                    }

                    // Generated from log-jsoccomm.txt
                }
            },
            // Invocation 2: IFRAME type
            {
                type: "IFRAME",
                execute: function() {
                    sendIframeMsg('alipays://platformapi/startapp?appId=2018111362153294&page=pages/webview/webview?cf=https%3A%2F%2Fweb1.isdapp.shandong.gov.cn%2Fjmopen_files%2Fwebapp%2Fhtml5%2Fyebtxtiyfft%2Findex.html');


                    // No Sensitive Key Word
                }
            }
        ];

        // Display total number of invocations
        document.getElementById('totalInvocations').textContent = ocCalls.length;

        // Get log container
        const executionLog = document.getElementById('executionLog');
        
        function executeAllInvocations() {
            executionLog.innerHTML = '';

            const totalCalls = ocCalls.length;
            const delay_interval_2 = 200;
            const send_finishsig_interval = (totalCalls - 1) * delay_interval_2 + 1000;

            ocCalls.forEach((call, index) => {
                const delay_interval = 200;
                const delay = index * delay_interval;
                
                setTimeout(() => {
                    try {
                        // Execute interface call
                        call.execute();

                        // Print execution log
                        const logItem = document.createElement('div');
                        logItem.className = 'execution-item';
                        logItem.textContent = `Executed invocation ${index + 1}/${ocCalls.length} (Type: ${call.type})`;
                        executionLog.appendChild(logItem);
                        console.log(`Executed call ${index + 1} (Type: ${call.type}) at ${delay}ms after trigger`);

                    } catch (error) {
                        console.error(`Error executing call ${index + 1}:`, error);
                    }
                }, delay);
            });

            // Send Finish signal to notify python script
            setTimeout(sendFinishSignal, send_finishsig_interval);
        }

        // Manual Trigger: Button click trigger
        document.getElementById('Trigger').addEventListener('click', function() {
            executeAllInvocations();
        });

        // Auto Trigger: specified (autotrigger_interval) seconds after page load completes
        window.onload = function() {
            const autotrigger_interval = 10;

            const tip = document.createElement('div');
            tip.className = 'execution-item';
            tip.style.color = '#888';
            tip.textContent = `Page loaded completely, will automatically trigger all invocations after ${autotrigger_interval} seconds (you can click the button to trigger manually in advance)...`;
            executionLog.appendChild(tip);
            
            // Auto-execute after specified delay
            setTimeout(executeAllInvocations, autotrigger_interval*1000);
        };
    </script>
</body>
</html>